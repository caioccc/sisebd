{% extends 'base.html' %}
{% block content %}
    <div class="row">
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-aqua"><i class="fa fa-database"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Dados Usados</span>
                    <span class="info-box-number">{{ dados }}
                        <small>%</small></span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-red"><i class="fa fa-credit-card-alt"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Plano Contratado</span>
                    <span class="info-box-number">Gratuito</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->

        <!-- fix for small devices only -->
        <div class="clearfix visible-sm-block"></div>

        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-green"><i class="fa fa-institution"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Igreja</span>
                    <span class="info-box-number">{{ igreja.nome_igreja }}</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
        <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="info-box">
                <span class="info-box-icon bg-yellow"><i class="fa fa-phone"></i></span>

                <div class="info-box-content">
                    <span class="info-box-text">Contato</span>
                    <span class="info-box-number">{{ igreja.telefone }}</span>
                </div>
                <!-- /.info-box-content -->
            </div>
            <!-- /.info-box -->
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->

    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header with-border text-center">
                    <h3 class="box-title">
                        <form action="/filter-relatorio" method="get">{% csrf_token %}
                            <div class="row">
                                <div class="col-xs-5">
                                    <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1"><i
                                            class="fa fa-calendar-minus-o"></i> </span>
                                        <input type="text" class="form-control datepicker" id="init_data"
                                               name="init_data" required>
                                    </div>
                                </div>
                                <div class="col-xs-1 text-center" style="padding: 6px 0px 0px 0px;">
                                    <label>-</label>
                                </div>
                                <div class="col-xs-6">
                                    <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1"><i
                                            class="fa fa-calendar-plus-o"></i> </span>
                                        <input type="text" class="form-control datepicker" id="end_data"
                                               name="end_data" required>
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="submit"><i class="fa fa-search"></i>
                                            &nbsp;Filtrar
                                        </button>
                                    </span>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </h3>
                </div>
                <!-- /.box-header -->
                <div style="display: block;" class="box-body">
                    <div class="row">
                        <div class="col-md-8">
                            <p class="text-center">
                                <strong>Presentes</strong> <i class="fa fa-square" style="color: #4978cc"></i> x
                                <strong>Faltosos</strong> <i class="fa fa-square"
                                                             style="color: rgba(56, 106, 174, 0.26)"></i> :<span
                                    id="initDate"></span>
                                -
                                <span id="endDate"></span></strong>
                            </p>

                            <div class="chart">
                                <!-- Sales Chart Canvas -->
                                <canvas height="154" width="603" id="salesChart"
                                        style="height: 154px; width: 603px;"></canvas>
                            </div>
                            <!-- /.chart-responsive -->
                        </div>
                        <!-- /.col -->
                        <div class="col-md-4">
                            <p class="text-center">
                                <strong>Info Geral</strong>
                            </p>

                            <div class="progress-group">
                                <span class="progress-text">Alunos</span>
                                <span class="progress-number"><b>{{ igreja.alunos.all|length }}</b>/400</span>

                                <div class="progress sm">
                                    <div id="percent_alunos" class="progress-bar progress-bar-aqua"
                                         style="width: 80%"></div>
                                </div>
                            </div>
                            <!-- /.progress-group -->
                            <div class="progress-group">
                                <span class="progress-text">Presentes</span>
                                <span class="progress-number"><b>{{ presentes }}</b>%</span>

                                <div class="progress sm">
                                    <div id="percent_presentes" class="progress-bar progress-bar-green"
                                         style="width: 80%"></div>
                                </div>
                            </div>
                            <!-- /.progress-group -->
                            <div class="progress-group">
                                <span class="progress-text">Faltosos</span>
                                <span class="progress-number"><b>{{ faltosos }}</b>%</span>

                                <div class="progress sm">
                                    <div id="percent_faltosos" class="progress-bar progress-bar-red"
                                         style="width: 80%"></div>
                                </div>
                            </div>
                            <!-- /.progress-group -->
                            <div class="progress-group">
                                <span class="progress-text">Visitantes</span>
                                <span class="progress-number"><b>{{ visitantes }}</b></span>

                                <div class="progress sm">
                                    <div id="percent_visitantes" class="progress-bar progress-bar-yellow"
                                         style="width: 100%"></div>
                                </div>
                            </div>
                            <!-- /.progress-group -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </div>
                <!-- ./box-body -->
                <div style="display: block;" class="box-footer">
                    <div class="row">
                        <div class="col-sm-3 col-xs-6">
                            <div class="description-block border-right">
                                <h5 class="description-header">{{ igreja.departamentos.all|length }}</h5>
                                <span class="description-text">DEPARTAMENTOS</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                        <!-- /.col -->
                        <div class="col-sm-3 col-xs-6">
                            <div class="description-block border-right">
                                <h5 class="description-header">{{ igreja.professores.all|length }}</h5>
                                <span class="description-text">PROFESSORES</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                        <!-- /.col -->
                        <div class="col-sm-3 col-xs-6">
                            <div class="description-block border-right">
                                <h5 class="description-header">{{ igreja.classes.all|length }}</h5>
                                <span class="description-text">CLASSES</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                        <!-- /.col -->
                        <div class="col-sm-3 col-xs-6">
                            <div class="description-block">
                                <h5 class="description-header">{{ igreja.aulas.all|length }}</h5>
                                <span class="description-text">AULAS REGISTRADAS</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                    </div>
                    <!-- /.row -->
                </div>
                <!-- /.box-footer -->
            </div>
            <!-- /.box -->
        </div>
    </div>

    <!-- Main row -->
    <div class="row">
        <!-- Left col -->
        <div class="col-md-8">
        </div>
        <!-- /.col -->

        <div class="col-md-4">
            <div class="box box-widget widget-user">
                <!-- Add the bg color to the header using any of the bg-* classes -->
                <div class="widget-user-header bg-aqua-active">
                    <h3 class="widget-user-username">{{ igreja.nome_responsavel }}</h3>
                    <h5 class="widget-user-desc">Usuario Adm</h5>
                </div>
                <div class="widget-user-image">
                    {% if igreja.foto %}
                        <img class="img-circle" src="{{ igreja.foto }}" alt="{{ igreja.nome_responsavel }}">
                    {% else %}
                        <img class="img-circle" src="http://lorempixel.com/128/128/"
                             alt="{{ igreja.nome_responsavel }}">
                    {% endif %}

                </div>
                <div class="box-footer">
                    <div class="row">
                        <div class="col-sm-4 border-right">
                            <div class="description-block">
                                <h5 class="description-header">{{ igreja.id }}</h5>
                                <span class="description-text">ID</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                        <!-- /.col -->
                        <div class="col-sm-4 border-right">
                            <div class="description-block">
                                <h5 class="description-header">{{ igreja.qtd_membros }}</h5>
                                <span class="description-text">MEMBROS</span>
                            </div>
                            <!-- /.description-block -->
                        </div>
                        <!-- /.col -->
                        <div class="col-sm-4">
                            <div class="description-block">
                                <h5 class="description-header">{{ igreja.updated_at|date:"d/m/Y H:m" }}</h5>
                            </div>
                            <!-- /.description-block -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </div>
            </div>
            <!-- Info Boxes Style 2 -->
        </div>
        <!-- /.col -->
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            var steps = [
                {
                    placement: "center",
                    content: 'Ola, Bem vindo ao SisEBD o seu sistema de gerenciamento da escola biblica dominical de ' +
                    'sua igreja. Com nosso sistema, o seu controle fica armazenado em "cloud", podendo acessar de ' +
                    'qualquer lugar.',
                    backdrop: true,
                    orphan: true
                }
            ];
            xinguTour(window.location.href, steps);
            if (parseInt({{ primeira_entrada }}) === 1) {
                clearTour(window.location.href);
            }
            console.log('{{ initData }}');
            console.log('{{ endData }}');
            console.log({{ arr_datas|safe }});
            console.log({{ arr_faltosos|safe }});
            console.log({{ arr_presentes|safe }});
            palunos = 0;
            ppresentes = 0;
            pfaltosos = 0;
            nvisitantes = parseInt({{ visitantes }});
            if (nvisitantes === 0 || nvisitantes === undefined || nvisitantes === null) {
                $('#percent_visitantes').attr('style', 'width: 0%');
            }
            try {
                palunos = parseFloat({{ igreja.alunos.all|length }}) / 4;
                ppresentes = parseFloat({{ presentes }});
                pfaltosos = parseFloat({{ faltosos }});
            } catch (e) {
            }
            $('#inicio').addClass('active');
            $('#initDate').text('{{ initData }}');
            $('#endDate').text('{{ endData }}');
            $('#percent_alunos').attr('style', 'width:' + palunos + '%');
            $('#percent_presentes').attr('style', 'width:' + ppresentes + '%');
            $('#percent_faltosos').attr('style', 'width:' + pfaltosos + '%');

            var dataReport = {
                labels: {{ arr_datas|safe }},
                datasets: [
                    {
                        label: "Presentes",
                        fillColor: "rgb(210, 214, 222)",
                        strokeColor: "rgb(210, 214, 222)",
                        pointColor: "rgb(210, 214, 222)",
                        pointStrokeColor: "#c1c7d1",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgb(220,220,220)",
                        data: {{ arr_faltosos|safe }}
                    },
                    {
                        label: "Faltosos",
                        fillColor: "rgba(60,141,188,0.9)",
                        strokeColor: "rgba(60,141,188,0.8)",
                        pointColor: "#3b8bba",
                        pointStrokeColor: "rgba(60,141,188,1)",
                        pointHighlightFill: "#fff",
                        pointHighlightStroke: "rgba(60,141,188,1)",
                        data: {{ arr_presentes|safe }}

                    }
                ]
            };
            init_report(dataReport);
        });
    </script>
{% endblock %}